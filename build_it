CUR_TC=~/android/test/AK-linaro/4.7.4-2014.04.20140418.CR83/bin/

### compile kernel
ARCH=arm CROSS_COMPILE=${CUR_TC}arm-gnueabi- make mod_rhine_defconfig
ARCH=arm CROSS_COMPILE=${CUR_TC}arm-gnueabi- make xconfig
cp ./.config arch/arm/configs/mod_rhine_defconfig
ARCH=arm CROSS_COMPILE=${CUR_TC}arm-gnueabi- make CONFIG_DEBUG_SECTION_MISMATCH=y -j8

echo "checking for compiled kernel..."
if [ -f arch/arm/boot/zImage ]
then

echo "generating device tree..."
../build_44/dtbTool -o ../build_44/dt.img -s 2048 -p ./scripts/dtc/ ./arch/arm/boot/

### copy zImage
cp arch/arm/boot/zImage ../build_44/.

if [ -d ../build_44/boot.img-ramdisk/multirom/ ]
then
#Copy ExFAT
#cp drivers/exfat/exfat_core.ko ../build_44/boot.img-ramdisk/multirom/lib/
#cp drivers/exfat/exfat_fs.ko ../build_44/boot.img-ramdisk/multirom/lib/

#Copy Peripheral Driver
cp drivers/hid/hid-sony.ko ../build_44/boot.img-ramdisk/multirom/lib/

#Copy Gamma Driver
cp arch/arm/mach-msm/msm_kcal_ctrl.ko ../build_44/boot.img-ramdisk/multirom/lib/

else

#Copy ExFAT
#cp drivers/exfat/exfat_core.ko ../build_44/boot.img-ramdisk/lib/
#cp drivers/exfat/exfat_fs.ko ../build_44/boot.img-ramdisk/lib/

#Copy Peripheral Driver
cp drivers/hid/hid-sony.ko ../build_44/boot.img-ramdisk/lib/

#Copy Gamma Driver
#cp arch/arm/mach-msm/msm_kcal_ctrl.ko ../build_44/boot.img-ramdisk/lib/

fi

cd ../build_44/

~/android/build_44/make_it.sh
fi
